<!-- Minecraft Settings Screen - Windows 11 Style -->
<div class="settings-container">
    <!-- Header Section -->
    <div class="settings-header">
        <div class="header-content">
            <div class="header-text">
                <h1>Settings</h1>
                <p>Configure your launcher preferences and game settings</p>
            </div>
            <button class="reset-button" onclick="resetToDefaults()">
                <span class="button-icon">üîÑ</span>
                <span>Reset to Defaults</span>
            </button>
        </div>
    </div>

    <!-- Settings Grid -->
    <div class="settings-grid">
        <!-- Launcher Settings Card -->
        <div class="settings-card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">üöÄ</div>
                    <h3>Launcher</h3>
                </div>
            </div>
            <div class="card-content">
                <div class="setting-group">
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Auto-launch on startup</div>
                            <div class="setting-description">Start the launcher when Windows starts</div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoLaunch" onchange="saveSetting('autoLaunch', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Minimize to system tray</div>
                            <div class="setting-description">Keep launcher running in background</div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="minimizeToTray" onchange="saveSetting('minimizeToTray', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Close launcher after game launch</div>
                            <div class="setting-description">Automatically close launcher when game starts</div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="closeAfterLaunch" onchange="saveSetting('closeAfterLaunch', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Theme</div>
                            <div class="setting-description">Choose your preferred appearance</div>
                        </div>
                        <div class="setting-control">
                            <select id="theme" class="setting-select" onchange="saveSetting('theme', this.value)">
                                <option value="auto">Follow system</option>
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Language</div>
                            <div class="setting-description">Select your preferred language</div>
                        </div>
                        <div class="setting-control">
                            <select id="language" class="setting-select" onchange="saveSetting('language', this.value)">
                                <option value="en">English</option>
                                <option value="es">Espa√±ol</option>
                                <option value="fr">Fran√ßais</option>
                                <option value="de">Deutsch</option>
                                <option value="it">Italiano</option>
                                <option value="pt">Portugu√™s</option>
                                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                                <option value="ja">Êó•Êú¨Ë™û</option>
                                <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                                <option value="zh">‰∏≠Êñá</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Settings Card -->
        <div class="settings-card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">üéÆ</div>
                    <h3>Game</h3>
                </div>
            </div>
            <div class="card-content">
                <div class="setting-group">
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Default memory allocation</div>
                            <div class="setting-description">Memory allocated to new profiles</div>
                        </div>
                        <div class="setting-control">
                            <div class="memory-input-group">
                                <input type="range" id="defaultMemory" class="memory-slider" min="1024" max="16384" value="4096" step="256" oninput="updateMemoryDisplay(this.value)">
                                <div class="memory-display">
                                    <span id="memoryValue">4096</span>
                                    <span class="memory-unit">MB</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Game directory</div>
                            <div class="setting-description">Default location for Minecraft installations</div>
                        </div>
                        <div class="setting-control">
                            <div class="directory-input-group">
                                <input type="text" id="gameDirectory" class="setting-input" readonly>
                                <button class="browse-button" onclick="browseGameDirectory()">
                                    <span>üìÅ</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Java path</div>
                            <div class="setting-description">Path to Java installation</div>
                        </div>
                        <div class="setting-control">
                            <div class="directory-input-group">
                                <input type="text" id="javaPath" class="setting-input" readonly>
                                <button class="browse-button" onclick="browseJavaPath()">
                                    <span>üìÅ</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Skip asset verification</div>
                            <div class="setting-description">Faster launching but may cause issues</div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="skipAssetVerification" onchange="saveSetting('skipAssetVerification', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Enable JVM optimizations</div>
                            <div class="setting-description">Apply performance optimizations to JVM</div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="jvmOptimizations" checked onchange="saveSetting('jvmOptimizations', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Settings Card -->
        <div class="settings-card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">üåê</div>
                    <h3>Network</h3>
                </div>
            </div>
            <div class="card-content">
                <div class="setting-group">
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Concurrent downloads</div>
                            <div class="setting-description">Number of simultaneous downloads</div>
                        </div>
                        <div class="setting-control">
                            <select id="concurrentDownloads" class="setting-select" onchange="saveSetting('concurrentDownloads', this.value)">
                                <option value="1">1 (Slow)</option>
                                <option value="2">2</option>
                                <option value="4" selected>4 (Default)</option>
                                <option value="6">6</option>
                                <option value="8">8 (Fast)</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Download speed limit</div>
                            <div class="setting-description">Maximum download speed (0 = unlimited)</div>
                        </div>
                        <div class="setting-control">
                            <div class="speed-input-group">
                                <input type="number" id="downloadSpeedLimit" class="setting-input" value="0" min="0" step="1" onchange="saveSetting('downloadSpeedLimit', this.value)">
                                <span class="speed-unit">MB/s</span>
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Use proxy</div>
                            <div class="setting-description">Route downloads through proxy server</div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="useProxy" onchange="toggleProxy(this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item proxy-settings" id="proxySettings" style="display: none;">
                        <div class="setting-info">
                            <div class="setting-label">Proxy server</div>
                            <div class="setting-description">Host:Port (e.g., proxy.example.com:8080)</div>
                        </div>
                        <div class="setting-control">
                            <input type="text" id="proxyServer" class="setting-input" placeholder="proxy.example.com:8080" onchange="saveSetting('proxyServer', this.value)">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Settings Card -->
        <div class="settings-card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">‚öôÔ∏è</div>
                    <h3>Advanced</h3>
                </div>
            </div>
            <div class="card-content">
                <div class="setting-group">
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Enable debug logging</div>
                            <div class="setting-description">Detailed logs for troubleshooting</div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="debugLogging" onchange="saveSetting('debugLogging', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Keep launcher logs</div>
                            <div class="setting-description">Number of log files to retain</div>
                        </div>
                        <div class="setting-control">
                            <select id="logRetention" class="setting-select" onchange="saveSetting('logRetention', this.value)">
                                <option value="3">3 files</option>
                                <option value="5" selected>5 files</option>
                                <option value="10">10 files</option>
                                <option value="20">20 files</option>
                                <option value="0">Unlimited</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Check for updates</div>
                            <div class="setting-description">Automatically check for launcher updates</div>
                        </div>
                        <div class="setting-control">
                            <select id="updateCheck" class="setting-select" onchange="saveSetting('updateCheck', this.value)">
                                <option value="startup">On startup</option>
                                <option value="daily" selected>Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="never">Never</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Experimental features</div>
                            <div class="setting-description">Enable beta features (may be unstable)</div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="experimentalFeatures" onchange="saveSetting('experimentalFeatures', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons Card -->
        <div class="settings-card actions-card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">üõ†Ô∏è</div>
                    <h3>Actions</h3>
                </div>
            </div>
            <div class="card-content">
                <div class="actions-grid">
                    <button class="action-button" onclick="openLogsFolder()">
                        <div class="action-icon">üìÑ</div>
                        <div class="action-text">
                            <div class="action-title">Open Logs</div>
                            <div class="action-subtitle">View launcher logs</div>
                        </div>
                    </button>

                    <button class="action-button" onclick="clearCache()">
                        <div class="action-icon">üóëÔ∏è</div>
                        <div class="action-text">
                            <div class="action-title">Clear Cache</div>
                            <div class="action-subtitle">Free up disk space</div>
                        </div>
                    </button>

                    <button class="action-button" onclick="exportSettings()">
                        <div class="action-icon">üì§</div>
                        <div class="action-text">
                            <div class="action-title">Export Settings</div>
                            <div class="action-subtitle">Backup configuration</div>
                        </div>
                    </button>

                    <button class="action-button" onclick="importSettings()">
                        <div class="action-icon">üì•</div>
                        <div class="action-text">
                            <div class="action-title">Import Settings</div>
                            <div class="action-subtitle">Restore configuration</div>
                        </div>
                    </button>

                    <button class="action-button" onclick="repairInstallation()">
                        <div class="action-icon">üîß</div>
                        <div class="action-text">
                            <div class="action-title">Repair Installation</div>
                            <div class="action-subtitle">Fix launcher issues</div>
                        </div>
                    </button>

                    <button class="action-button danger" onclick="resetLauncher()">
                        <div class="action-icon">‚ö†Ô∏è</div>
                        <div class="action-text">
                            <div class="action-title">Reset Launcher</div>
                            <div class="action-subtitle">Complete reset</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.settings-container {
    display: flex;
    flex-direction: column;
    gap: 24px;
    height: 100%;
    overflow-y: auto;
    padding: 0 24px 24px 24px;
}

/* Header Section */
.settings-header {
    background: var(--win11-surface-elevated);
    border: 1px solid var(--win11-stroke);
    border-radius: var(--win11-radius-large);
    padding: 24px;
    position: relative;
    overflow: hidden;
}

.settings-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, var(--win11-accent) 0%, transparent 70%);
    opacity: 0.03;
    pointer-events: none;
}

.header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 16px;
}

.header-text h1 {
    margin: 0;
    font-size: 24px;
    font-weight: 600;
    color: var(--win11-text-primary);
    line-height: 1.2;
}

.header-text p {
    margin: 4px 0 0 0;
    font-size: 14px;
    color: var(--win11-text-secondary);
    line-height: 1.4;
}

.reset-button {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    background: var(--win11-surface);
    color: var(--win11-text-primary);
    border: 1px solid var(--win11-stroke);
    border-radius: var(--win11-radius-medium);
    cursor: pointer;
    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    font-family: inherit;
    font-size: 14px;
    font-weight: 500;
}

.reset-button:hover {
    background: var(--win11-surface-alt);
    border-color: var(--win11-accent);
    transform: translateY(-1px);
}

.button-icon {
    font-size: 16px;
}

/* Settings Grid */
.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
}

.settings-card {
    background: var(--win11-surface-elevated);
    border: 1px solid var(--win11-stroke);
    border-radius: var(--win11-radius-large);
    overflow: hidden;
    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

.settings-card:hover {
    border-color: var(--win11-accent);
    box-shadow: var(--win11-shadow-elevation-low);
}

.card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 20px 16px 20px;
    border-bottom: 1px solid var(--win11-stroke-subtle);
}

.card-title {
    display: flex;
    align-items: center;
    gap: 12px;
}

.card-icon {
    font-size: 18px;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--win11-accent);
    color: var(--win11-accent-text, white);
    border-radius: var(--win11-radius-small);
    flex-shrink: 0;
}

.card-title h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--win11-text-primary);
}

.card-content {
    padding: 20px;
}

/* Setting Items */
.setting-group {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.setting-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    min-height: 48px;
}

.setting-info {
    flex: 1;
    min-width: 0;
}

.setting-label {
    font-size: 14px;
    font-weight: 500;
    color: var(--win11-text-primary);
    margin-bottom: 4px;
    line-height: 1.3;
}

.setting-description {
    font-size: 12px;
    color: var(--win11-text-secondary);
    line-height: 1.4;
}

.setting-control {
    flex-shrink: 0;
}

/* Toggle Switch */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
    cursor: pointer;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--win11-stroke);
    border-radius: 12px;
    transition: all 0.2s ease;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background: white;
    border-radius: 50%;
    transition: all 0.2s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

.toggle-switch input:checked + .toggle-slider {
    background: var(--win11-accent);
}

.toggle-switch input:checked + .toggle-slider:before {
    transform: translateX(20px);
}

.toggle-switch:hover .toggle-slider {
    opacity: 0.8;
}

/* Select Input */
.setting-select {
    padding: 8px 12px;
    background: var(--win11-surface);
    border: 1px solid var(--win11-stroke);
    border-radius: var(--win11-radius-small);
    font-size: 14px;
    color: var(--win11-text-primary);
    transition: all 0.15s ease;
    font-family: inherit;
    min-width: 140px;
}

.setting-select:focus {
    outline: none;
    border-color: var(--win11-accent);
    box-shadow: 0 0 0 1px var(--win11-accent);
}

/* Input Fields */
.setting-input {
    padding: 8px 12px;
    background: var(--win11-surface);
    border: 1px solid var(--win11-stroke);
    border-radius: var(--win11-radius-small);
    font-size: 14px;
    color: var(--win11-text-primary);
    transition: all 0.15s ease;
    font-family: inherit;
    min-width: 140px;
}

.setting-input:focus {
    outline: none;
    border-color: var(--win11-accent);
    box-shadow: 0 0 0 1px var(--win11-accent);
}

.setting-input:read-only {
    background: var(--win11-surface-alt);
    color: var(--win11-text-secondary);
}

/* Memory Input Group */
.memory-input-group {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 200px;
}

.memory-slider {
    flex: 1;
    height: 6px;
    background: var(--win11-stroke);
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
}

.memory-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    background: var(--win11-accent);
    border-radius: 50%;
    cursor: pointer;
}

.memory-slider::-moz-range-thumb {
    width: 18px;
    height: 18px;
    background: var(--win11-accent);
    border-radius: 50%;
    border: none;
    cursor: pointer;
}

.memory-display {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 14px;
    font-weight: 500;
    color: var(--win11-text-primary);
    min-width: 60px;
}

.memory-unit {
    font-size: 12px;
    color: var(--win11-text-secondary);
}

/* Directory Input Group */
.directory-input-group {
    display: flex;
    gap: 8px;
    min-width: 200px;
}

.directory-input-group .setting-input {
    flex: 1;
    min-width: 0;
}

.browse-button {
    width: 36px;
    height: 36px;
    background: var(--win11-surface);
    border: 1px solid var(--win11-stroke);
    border-radius: var(--win11-radius-small);
    color: var(--win11-text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: all 0.15s ease;
    flex-shrink: 0;
}

.browse-button:hover {
    background: var(--win11-surface-alt);
    border-color: var(--win11-accent);
}

/* Speed Input Group */
.speed-input-group {
    display: flex;
    align-items: center;
    gap: 8px;
}

.speed-input-group .setting-input {
    width: 80px;
    text-align: center;
}

.speed-unit {
    font-size: 12px;
    color: var(--win11-text-secondary);
    font-weight: 500;
}

/* Proxy Settings */
.proxy-settings {
    margin-left: 20px;
    padding-left: 20px;
    border-left: 2px solid var(--win11-stroke-subtle);
}

/* Actions Card */
.actions-card .card-content {
    padding: 16px;
}

.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
}

.action-button {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: var(--win11-surface);
    border: 1px solid var(--win11-stroke-subtle);
    border-radius: var(--win11-radius-medium);
    cursor: pointer;
    transition: all 0.15s ease;
    font-family: inherit;
    text-align: left;
}

.action-button:hover {
    background: var(--win11-surface-alt);
    border-color: var(--win11-stroke);
    transform: translateY(-2px);
}

.action-button.danger:hover {
    background: #E74856;
    border-color: #E74856;
    color: white;
}

.action-button.danger:hover .action-icon,
.action-button.danger:hover .action-text {
    color: white;
}

.action-icon {
    font-size: 20px;
    width: 36px;
    height: 36px;
    background: var(--win11-accent);
    color: var(--win11-accent-text, white);
    border-radius: var(--win11-radius-small);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.action-text {
    flex: 1;
    min-width: 0;
}

.action-title {
    font-size: 14px;
    font-weight: 500;
    color: var(--win11-text-primary);
    margin-bottom: 2px;
    line-height: 1.3;
}

.action-subtitle {
    font-size: 12px;
    color: var(--win11-text-secondary);
    line-height: 1.3;
}

/* Responsive Design */
@media (max-width: 768px) {
    .settings-container {
        padding: 0 16px 16px 16px;
        gap: 16px;
    }
    
    .settings-header {
        padding: 20px;
    }
    
    .header-content {
        flex-direction: column;
        align-items: stretch;
    }
    
    .settings-grid {
        grid-template-columns: 1fr;
    }
    
    .setting-item {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
    }
    
    .setting-control {
        width: 100%;
        display: flex;
        justify-content: flex-end;
    }
    
    .memory-input-group,
    .directory-input-group {
        min-width: 0;
        width: 100%;
    }
    
    .actions-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .action-button {
        padding: 12px;
    }
    
    .action-icon {
        width: 32px;
        height: 32px;
        font-size: 16px;
    }
    
    .card-content {
        padding: 16px !important;
    }
}
</style>

<script>
// Minecraft Settings Screen Functions
let currentSettings = {};

// Initialize settings screen
window.MinecraftSettings = {
    initialize: function(authSession) {
        console.log('Initializing Minecraft settings screen');
        loadSettings();
    }
};

function loadSettings() {
    // Load settings from localStorage or set defaults
    currentSettings = {
        // Launcher settings
        autoLaunch: false,
        minimizeToTray: true,
        closeAfterLaunch: false,
        theme: 'auto',
        language: 'en',
        
        // Game settings
        defaultMemory: 4096,
        gameDirectory: '',
        javaPath: '',
        skipAssetVerification: false,
        jvmOptimizations: true,
        
        // Network settings
        concurrentDownloads: 4,
        downloadSpeedLimit: 0,
        useProxy: false,
        proxyServer: '',
        
        // Advanced settings
        debugLogging: false,
        logRetention: 5,
        updateCheck: 'daily',
        experimentalFeatures: false
    };
    
    // Try to load from localStorage
    const savedSettings = localStorage.getItem('minecraftSettings');
    if (savedSettings) {
        try {
            const parsed = JSON.parse(savedSettings);
            currentSettings = { ...currentSettings, ...parsed };
        } catch (error) {
            console.error('Failed to parse saved settings:', error);
        }
    }
    
    applySettings();
}

function applySettings() {
    // Apply all settings to the UI
    Object.keys(currentSettings).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
            if (element.type === 'checkbox') {
                element.checked = currentSettings[key];
            } else {
                element.value = currentSettings[key];
            }
        }
    });
    
    // Special handling for memory slider
    updateMemoryDisplay(currentSettings.defaultMemory);
    
    // Show/hide proxy settings
    toggleProxy(currentSettings.useProxy);
}

function saveSetting(key, value) {
    currentSettings[key] = value;
    
    // Save to localStorage
    localStorage.setItem('minecraftSettings', JSON.stringify(currentSettings));
    
    // Apply any special logic
    if (key === 'theme') {
        applyTheme(value);
    } else if (key === 'language') {
        applyLanguage(value);
    }
    
    console.log(`Setting saved: ${key} = ${value}`);
    
    if (window.MosaicLauncher) {
        window.MosaicLauncher.showToast(`Setting updated: ${key}`);
    }
}

function updateMemoryDisplay(value) {
    document.getElementById('memoryValue').textContent = value;
    document.getElementById('defaultMemory').value = value;
    saveSetting('defaultMemory', parseInt(value));
}

function toggleProxy(enabled) {
    const proxySettings = document.getElementById('proxySettings');
    proxySettings.style.display = enabled ? 'flex' : 'none';
    saveSetting('useProxy', enabled);
}

function applyTheme(theme) {
    // This would integrate with the main theme system
    console.log('Applying theme:', theme);
    
    if (window.MosaicLauncher) {
        window.MosaicLauncher.setTheme(theme);
    }
}

function applyLanguage(language) {
    // This would integrate with the main localization system
    console.log('Applying language:', language);
    
    if (window.MosaicLauncher) {
        window.MosaicLauncher.setLanguage(language);
    }
}

// File browser functions
async function browseGameDirectory() {
    try {
        const tauriApi = window.MosaicLauncher.tauriApi();
        if (!tauriApi) {
            throw new Error('Tauri API not available');
        }

        const result = await tauriApi.invoke('browse_directory', {
            title: 'Select Game Directory'
        });
        
        if (result) {
            document.getElementById('gameDirectory').value = result;
            saveSetting('gameDirectory', result);
        }
    } catch (error) {
        console.error('Failed to browse directory:', error);
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast(`Failed to browse directory: ${error.message}`);
        }
    }
}

async function browseJavaPath() {
    try {
        const tauriApi = window.MosaicLauncher.tauriApi();
        if (!tauriApi) {
            throw new Error('Tauri API not available');
        }

        const result = await tauriApi.invoke('browse_file', {
            title: 'Select Java Executable',
            filters: [
                { name: 'Java Executable', extensions: ['exe'] }
            ]
        });
        
        if (result) {
            document.getElementById('javaPath').value = result;
            saveSetting('javaPath', result);
        }
    } catch (error) {
        console.error('Failed to browse file:', error);
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast(`Failed to browse file: ${error.message}`);
        }
    }
}

// Action functions
async function openLogsFolder() {
    try {
        const tauriApi = window.MosaicLauncher.tauriApi();
        if (!tauriApi) {
            throw new Error('Tauri API not available');
        }

        await tauriApi.invoke('open_logs_folder');
        
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast('Logs folder opened');
        }
    } catch (error) {
        console.error('Failed to open logs folder:', error);
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast(`Failed to open logs: ${error.message}`);
        }
    }
}

async function clearCache() {
    if (!confirm('This will clear all cached files. Continue?')) {
        return;
    }
    
    try {
        const tauriApi = window.MosaicLauncher.tauriApi();
        if (!tauriApi) {
            throw new Error('Tauri API not available');
        }

        await tauriApi.invoke('clear_cache');
        
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast('Cache cleared successfully');
        }
    } catch (error) {
        console.error('Failed to clear cache:', error);
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast(`Failed to clear cache: ${error.message}`);
        }
    }
}

async function exportSettings() {
    try {
        const tauriApi = window.MosaicLauncher.tauriApi();
        if (!tauriApi) {
            throw new Error('Tauri API not available');
        }

        const result = await tauriApi.invoke('export_settings', {
            settings: currentSettings
        });
        
        if (result) {
            if (window.MosaicLauncher) {
                window.MosaicLauncher.showToast('Settings exported successfully');
            }
        }
    } catch (error) {
        console.error('Failed to export settings:', error);
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast(`Failed to export settings: ${error.message}`);
        }
    }
}

async function importSettings() {
    try {
        const tauriApi = window.MosaicLauncher.tauriApi();
        if (!tauriApi) {
            throw new Error('Tauri API not available');
        }

        const result = await tauriApi.invoke('import_settings');
        
        if (result) {
            currentSettings = { ...currentSettings, ...result };
            localStorage.setItem('minecraftSettings', JSON.stringify(currentSettings));
            applySettings();
            
            if (window.MosaicLauncher) {
                window.MosaicLauncher.showToast('Settings imported successfully');
            }
        }
    } catch (error) {
        console.error('Failed to import settings:', error);
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast(`Failed to import settings: ${error.message}`);
        }
    }
}

async function repairInstallation() {
    if (!confirm('This will repair the launcher installation. Continue?')) {
        return;
    }
    
    try {
        const tauriApi = window.MosaicLauncher.tauriApi();
        if (!tauriApi) {
            throw new Error('Tauri API not available');
        }

        await tauriApi.invoke('repair_installation');
        
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast('Installation repaired successfully');
        }
    } catch (error) {
        console.error('Failed to repair installation:', error);
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast(`Failed to repair installation: ${error.message}`);
        }
    }
}

async function resetLauncher() {
    if (!confirm('This will reset the launcher to factory defaults. All settings and profiles will be lost. Continue?')) {
        return;
    }
    
    if (!confirm('Are you absolutely sure? This action cannot be undone.')) {
        return;
    }
    
    try {
        const tauriApi = window.MosaicLauncher.tauriApi();
        if (!tauriApi) {
            throw new Error('Tauri API not available');
        }

        await tauriApi.invoke('reset_launcher');
        
        // Clear local storage
        localStorage.clear();
        
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast('Launcher reset successfully');
        }
        
        // Reload the application
        setTimeout(() => {
            window.location.reload();
        }, 2000);
    } catch (error) {
        console.error('Failed to reset launcher:', error);
        if (window.MosaicLauncher) {
            window.MosaicLauncher.showToast(`Failed to reset launcher: ${error.message}`);
        }
    }
}

function resetToDefaults() {
    if (!confirm('This will reset all settings to their default values. Continue?')) {
        return;
    }
    
    // Clear localStorage and reload defaults
    localStorage.removeItem('minecraftSettings');
    loadSettings();
    
    if (window.MosaicLauncher) {
        window.MosaicLauncher.showToast('Settings reset to defaults');
    }
}

// Initialize when loaded
console.log('Minecraft Settings screen loaded');
</script> 
</script> 